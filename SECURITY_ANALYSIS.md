# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Denta CRM

## üìä –û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (–∏–∑ 10 –±–∞–ª–ª–æ–≤)

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - **4/10**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **Cookies –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏** - –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å:
  ```typescript
  cookieStore.set('denta_auth', 'valid', { ... })
  // –ó–Ω–∞—á–µ–Ω–∏–µ 'valid' –Ω–µ –∏–º–µ–µ—Ç –ø–æ–¥–ø–∏—Å–∏, –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å
  ```
- ‚ùå **–•–∞—Ä–¥–∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞** –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
  ```typescript
  // app/contexts/AuthContext.tsx
  const isAdmin = userData.username === 'admin' || userData.first_name === 'Admin'
  
  // app/api/auth/email-login/route.ts
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ cookie, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î
  ```
- ‚ö†Ô∏è **–ê–¥–º–∏–Ω—Å–∫–∏–π –ø–∞—Ä–æ–ª—å –≤ –∫–æ–¥–µ** (fallback):
  ```typescript
  const ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || 'app_password'
  // Fallback –Ω–∞ 'app_password' - –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
  ```
- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è (pbkdf2)
- ‚úÖ Rate limiting —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

---

### 2. –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (RLS) - **2/10**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
```sql
-- supabase-setup-rls.sql
CREATE POLICY "Users can view patients"
  ON patients
  FOR SELECT
  USING (auth.role() = 'authenticated' OR auth.role() = 'anon');
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **RLS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –í–°–ï–ú** (–≤–∫–ª—é—á–∞—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö) –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
- ‚ùå –õ—é–±–æ–π, –∫—Ç–æ –∑–Ω–∞–µ—Ç URL –∏ –∫–ª—é—á–∏ Supabase, –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- ‚ùå –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏)

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**
```typescript
// –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ª—É—á–∏—Ç NEXT_PUBLIC_SUPABASE_ANON_KEY
// –ú–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ë–î –∏ –ø–æ–ª—É—á–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
const { data } = await supabase.from('patients').select('*')
// RLS –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç, —Ç–∞–∫ –∫–∞–∫ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω—ã–º
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è

---

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - **5/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email (regex)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **–°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email**:
  ```typescript
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  // –ü—Ä–æ—Å—Ç–æ–π regex, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å email
  ```
- ‚ö†Ô∏è **–ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ HTML** (—Ö–æ—Ç—è –Ω–µ—Ç XSS –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö)
- ‚ö†Ô∏è **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π**:
  ```typescript
  –§–ò–û: formData.get('name') as string // –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã
  ```
- ‚ö†Ô∏è **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö** (—Ç–æ–ª—å–∫–æ TypeScript, –Ω–µ—Ç runtime)
- ‚ö†Ô∏è **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è** –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

### 4. –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection - **8/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase Client (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚úÖ –ù–µ—Ç –ø—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫–æ–¥–µ
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ ORM

**–ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:**
```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
const { data } = await supabase
  .from('patients')
  .select('*')
  .eq('email', normalizedEmail) // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–æ
```

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è SQL —Å–∫—Ä–∏–ø—Ç—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–æ –æ–Ω–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ –∫–æ–¥–∞)
- ‚ö†Ô∏è –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ Supabase SQL Editor - –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π SQL

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–∏–∑–∫–∞—è (—Ö–æ—Ä–æ—à–æ –∑–∞—â–∏—â–µ–Ω–æ)

---

### 5. –ó–∞—â–∏—Ç–∞ –æ—Ç XSS (Cross-Site Scripting) - **7/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `dangerouslySetInnerHTML`
- ‚úÖ –ù–µ—Ç `innerHTML` –∏–ª–∏ `document.write`

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é (–Ω–æ React —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç)
- ‚ö†Ô∏è –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–∏–∑–∫–∞—è (—Ö–æ—Ä–æ—à–æ –∑–∞—â–∏—â–µ–Ω–æ)

---

### 6. –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF (Cross-Site Request Forgery) - **5/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ Cookies —Å `SameSite: 'lax'`
- ‚úÖ HttpOnly cookies

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **–ù–µ—Ç CSRF —Ç–æ–∫–µ–Ω–æ–≤** –¥–ª—è –º—É—Ç–∞—Ü–∏–π
- ‚ö†Ô∏è Server Actions –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç CSRF
- ‚ö†Ô∏è API endpoints –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç Origin/Referer

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**
```html
<!-- –ó–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–π —Å–∞–π—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å -->
<form action="https://denta-crm.com/api/patients" method="POST">
  <input name="–§–ò–û" value="–í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ">
</form>
<script>document.forms[0].submit()</script>
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

### 7. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ - **3/10**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **Cookies –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏** - –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å
- ‚ùå **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ç–æ–ª—å–∫–æ –≤ localStorage –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
- ‚ùå **Email –≤ cookie –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ**:
  ```typescript
  cookieStore.set('denta_user_email', userEmail, { ... })
  // Email —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
  ```
- ‚ö†Ô∏è –î–æ–ª–≥–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ cookie (30 –¥–Ω–µ–π)
- ‚úÖ HttpOnly cookies (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- ‚úÖ Secure flag –≤ production

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

---

### 8. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —É—Ç–µ—á–∫–∞ - **4/10**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **–î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö**:
  ```typescript
  return NextResponse.json(
    { error: `–û—à–∏–±–∫–∞ Supabase: ${error.message}` },
    { status: 500 }
  )
  // –†–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏
  ```
- ‚ùå **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
  ```typescript
  console.log('Login attempt:', {
    email: normalizedEmail,
    hasPasswordHash: !!user.password_hash,
    passwordHashLength: user.password_hash?.length
  })
  // –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ä–æ–ª—è—Ö
  ```
- ‚ùå **Stack traces –≤ –æ—à–∏–±–∫–∞—Ö**:
  ```typescript
  console.error('Email login error:', {
    message: error?.message,
    stack: error?.stack, // Stack trace –º–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    name: error?.name,
  })
  ```

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ –û–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ö†Ô∏è –ù–æ –¥–µ—Ç–∞–ª–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ª–æ–≥–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

### 9. –ó–∞—â–∏—Ç–∞ API endpoints - **4/10**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ whitelist —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø**:
  ```typescript
  catch (whitelistError) {
    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ whitelist, —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤—Ö–æ–¥ (fallback)
    // –ù–æ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  }
  ```
- ‚ö†Ô∏è **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**:
  - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ endpoints –ø—Ä–æ–≤–µ—Ä—è—é—Ç —á–µ—Ä–µ–∑ middleware
  - –î—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–Ω—É—Ç—Ä–∏ handler
  - Server Actions –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚ö†Ô∏è **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö**:
  ```typescript
  // app/patients/actions.ts
  export async function handleAddPatient(formData: FormData) {
    // –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!
    await addPatient(patientData)
  }
  ```

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ Rate limiting –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ –Ω–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö endpoints

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í—ã—Å–æ–∫–∞—è

---

### 10. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ - **6/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ `.gitignore` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ (–∫—Ä–æ–º–µ fallback)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **Fallback –∑–Ω–∞—á–µ–Ω–∏—è**:
  ```typescript
  const ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || 'app_password'
  // Fallback –Ω–∞ 'app_password' - –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
  ```
- ‚ö†Ô∏è **–ü—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –≤ NEXT_PUBLIC_***:
  ```typescript
  NEXT_PUBLIC_SUPABASE_ANON_KEY // –î–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  ```
- ‚ö†Ô∏è –ú–Ω–æ–≥–æ `console.log` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

### 11. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ - **4/10**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
  ```typescript
  logger.info('getPatients: –Ω–∞—á–∞–ª–æ', {
    email: normalizedEmail, // Email –≤ –ª–æ–≥–∞—Ö
    allowedDoctors, // –í—Ä–∞—á–∏ –≤ –ª–æ–≥–∞—Ö
  })
  ```
- ‚ùå **–ú–Ω–æ–≥–æ console.log** –≤–º–µ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ö†Ô∏è –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ö†Ô∏è –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

### 12. –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ - **7/10**

**–ß—Ç–æ —Ö–æ—Ä–æ—à–æ:**
- ‚úÖ Rate limiting —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (10 –∑–∞ 15 –º–∏–Ω—É—Ç)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (5 –∑–∞ 15 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è **In-memory rate limiting** (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ):
  ```typescript
  // lib/rate-limit.ts
  private requests: Map<string, RateLimitEntry> = new Map()
  // –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å—á–µ—Ç—á–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
  ```
- ‚ö†Ô∏è Rate limiting –æ—Ç–∫–ª—é—á–µ–Ω –≤ development —Ä–µ–∂–∏–º–µ:
  ```typescript
  if (!isDevelopment) {
    const isAllowed = rateLimiter.check(...)
  }
  ```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª | –í–µ—Å | –í–∑–≤–µ—à–µ–Ω–Ω—ã–π –±–∞–ª–ª |
|----------|------|-----|-----------------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | 4/10 | 20% | 0.8 |
| –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (RLS) | 2/10 | 20% | 0.4 |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | 5/10 | 10% | 0.5 |
| –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection | 8/10 | 10% | 0.8 |
| –ó–∞—â–∏—Ç–∞ –æ—Ç XSS | 7/10 | 5% | 0.35 |
| –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF | 5/10 | 10% | 0.5 |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ | 3/10 | 15% | 0.45 |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | 4/10 | 5% | 0.2 |
| –ó–∞—â–∏—Ç–∞ API endpoints | 4/10 | 10% | 0.4 |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ | 6/10 | 3% | 0.18 |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | 4/10 | 1% | 0.04 |
| –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ | 7/10 | 1% | 0.07 |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: 4.39/10**

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—é—Ç –≤—Å–µ–º –¥–æ—Å—Ç—É–ø (2/10)
**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
USING (auth.role() = 'authenticated' OR auth.role() = 'anon');
```
–õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, –∑–Ω–∞—è URL –∏ –∫–ª—é—á–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ email —á–µ—Ä–µ–∑ JWT –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å–µ—Å—Å–∏–π
USING (
  auth.jwt() ->> 'email' = created_by_email
  OR auth.jwt() ->> 'is_admin' = 'true'
);
```

### 2. Cookies –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏ (3/10)
**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
cookieStore.set('denta_auth', 'valid', { ... })
```
–ú–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å cookie –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω—ã —Å –ø–æ–¥–ø–∏—Å—å—é
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å session store (Redis)

### 3. Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ whitelist (4/10)
**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
catch (whitelistError) {
  // –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ - –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!
}
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

---

## üü° –°—Ä–µ–¥–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. –ù–µ—Ç CSRF –∑–∞—â–∏—Ç—ã (5/10)
- –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã –¥–ª—è –º—É—Ç–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å Origin/Referer

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —É—Ç–µ—á–∫–∞ –≤ –æ—à–∏–±–∫–∞—Ö (4/10)
- –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (4/10)
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å email, –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. **SQL Injection –∑–∞—â–∏—Ç–∞ (8/10)** - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. **XSS –∑–∞—â–∏—Ç–∞ (7/10)** - React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç
3. **Rate limiting (7/10)** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
4. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - pbkdf2 —Å —Å–æ–ª—å—é

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ email/JWT
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∫ cookies (JWT —Ç–æ–∫–µ–Ω—ã)
3. ‚úÖ –£–±—Ä–∞—Ç—å fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ whitelist
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Server Actions

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ - –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
1. –î–æ–±–∞–≤–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É
2. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏)
3. –£–±—Ä–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–¥–º–∏–Ω–∞ (–Ω–µ —Ö–∞—Ä–¥–∫–æ–¥)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
1. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è rate limiting
4. –î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üéØ –¶–µ–ª–µ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –¢–µ–∫—É—â–∏–π | –¶–µ–ª–µ–≤–æ–π | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|---------|---------|-----------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | 4/10 | 9/10 | +125% |
| RLS –∑–∞—â–∏—Ç–∞ | 2/10 | 9/10 | +350% |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ | 3/10 | 9/10 | +200% |
| –ó–∞—â–∏—Ç–∞ API | 4/10 | 9/10 | +125% |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | 4/10 | 8/10 | +100% |

**–¶–µ–ª–µ–≤–∞—è –æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 8.5/10**

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–º–µ–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏—è–º–∏. –û–¥–Ω–∞–∫–æ –±–∞–∑–æ–≤—ã–µ –∑–∞—â–∏—Ç—ã (SQL injection, XSS, rate limiting) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ö–æ—Ä–æ—à–æ.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∫ cookies (JWT)
3. –£–±—Ä–∞—Ç—å fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–µ–∑–¥–µ

**–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞: 4.39/10**  
**–¶–µ–ª–µ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: 8.5/10**
